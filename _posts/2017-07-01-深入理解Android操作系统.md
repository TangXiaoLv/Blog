---
title: 深入理解Android操作系统
layout: post
categories: 技术
tags: framework
---
Android Source:7.1.1

Linux Kernel:3.18

## 主线：开机到启动桌面过程
|引导 ▪|内核空间 ▪|用户空间(初始化) ▪|部分核心服务 ▪|Art虚拟机初始化 ▪|Java Runtime ▪|Java Runtime服务 ▪|Java Runtime服务 ▪|
|--:|--:|--:|--:|--:|--:|--:|
|[PBL](http://huaqianlee.github.io/2015/08/15/Android/%E9%AB%98%E9%80%9A%E5%B9%B3%E5%8F%B0Android%E6%BA%90%E7%A0%81bootloader%E5%88%86%E6%9E%90%E4%B9%8Bsbl1-%E4%B8%80/) ↓
|[init.S](http://androidxref.com/4.1.2/xref/bootable/bootloader/legacy/usbloader/init.S) ↓|
|**main.c:**[_main](http://androidxref.com/4.1.2/xref/bootable/bootloader/legacy/usbloader/main.c) →|**(PID=0) main.c:**[start_kernel](http://androidxref.com/kernel_3.18/xref/init/main.c) ↓|
||**main.c:**[rest_init](http://androidxref.com/kernel_3.18/xref/init/main.c) ↓|
||**main.c:**[kernel_init](http://androidxref.com/kernel_3.18/xref/init/main.c) →|**(PID=1)init.c:**[main](http://androidxref.com/7.1.1_r6/xref/system/core/init/init.cpp) ↓|
|||[init.rc](http://androidxref.com/7.1.1_r6/xref/system/core/rootdir/init.rc#39) →|**(PPID=1 假设PID=200)**[zygote](http://androidxref.com/7.1.1_r6/xref/frameworks/base/cmds/app_process/app_main.cpp) →|**AndroidRuntime.cpp:**[start](http://androidxref.com/7.1.1_r6/xref/frameworks/base/core/jni/AndroidRuntime.cpp#974) ↓|
|||→|**(PPID=1)** [servicemanager](http://androidxref.com/7.1.1_r6/xref/frameworks/native/cmds/servicemanager/service_manager.c) |**AndroidRuntime.cpp:**[startVm](http://androidxref.com/7.1.1_r6/xref/frameworks/base/core/jni/AndroidRuntime.cpp#581) ↓|
|||→|**(PPID=1)** [surfaceflinger](http://androidxref.com/7.1.1_r6/xref/frameworks/native/services/surfaceflinger/main_surfaceflinger.cpp)|**java_vm_ext.cc:**[JNI_CreateJavaVM](http://androidxref.com/7.1.1_r6/xref/art/runtime/java_vm_ext.cc#939) ↓|
|||→|**(PPID=1)** [cameraserver](http://androidxref.com/7.1.1_r6/xref/frameworks/av/camera/cameraserver/main_cameraserver.cpp)|**runtime.cc:**[Create](http://androidxref.com/7.1.1_r6/xref/art/runtime/runtime.cc#Create) ↓|
|||→|**(PPID=1)** [mediaserver](http://androidxref.com/7.1.1_r6/xref/frameworks/av/media/mediaserver/main_mediaserver.cpp)|**runtime.cc:**[Init](http://androidxref.com/7.1.1_r6/xref/art/runtime/runtime.cc#Init) ↓|
|||→|**(PPID=1)** [audioserver](http://androidxref.com/7.1.1_r6/xref/frameworks/av/media/audioserver/main_audioserver.cpp)|**runtime.cc:**[Start](http://androidxref.com/7.1.1_r6/xref/art/runtime/runtime.cc#Start) ↓|
|||||**AndroidRuntime.cpp:**[startReg](http://androidxref.com/7.1.1_r6/xref/frameworks/base/core/jni/AndroidRuntime.cpp#581) ↓|
|||||**END** →|**ZygoteInit.java:**[main](http://androidxref.com/7.1.1_r6/xref/frameworks/base/core/java/com/android/internal/os/ZygoteInit.java#709) →|-------------------------------|


PID = 当前进程ID
PPID = 父进程ID

PBL

[select/poll/epoll](https://segmentfault.com/a/1190000003063859)

当电源按下，引导芯片代码开始从预定义的地方（固化在ROM）开始执行。加载引导程序到RAM，然后执行

**ZygoteInit.java:**[main](http://androidxref.com/7.1.1_r6/xref/frameworks/base/core/java/com/android/internal/os/ZygoteInit.java#709) ↓
**fork ZygoteInit.java:**[startSystemServer](http://androidxref.com/7.1.1_r6/xref/frameworks/base/core/java/com/android/internal/os/ZygoteInit.java#709) ↓

**进入轮询等待连接**

<table border=3D0 cellpadding=3D0 cellspacing=3D0 width=3D1269 style=3D'bor=
der-collapse:
 collapse;table-layout:fixed;width:951pt'>
 <col width=3D74 style=3D'mso-width-source:userset;mso-width-alt:2525;width=
:56pt'>
 <col width=3D95 style=3D'mso-width-source:userset;mso-width-alt:3242;width=
:71pt'>
 <col width=3D132 style=3D'mso-width-source:userset;mso-width-alt:4505;widt=
h:99pt'>
 <col width=3D115 style=3D'mso-width-source:userset;mso-width-alt:3908;widt=
h:86pt'>
 <col width=3D150 style=3D'mso-width-source:userset;mso-width-alt:5102;widt=
h:112pt'>
 <col width=3D104 style=3D'mso-width-source:userset;mso-width-alt:3532;widt=
h:78pt'>
 <col width=3D140 style=3D'mso-width-source:userset;mso-width-alt:4778;widt=
h:105pt'>
 <col width=3D119 style=3D'mso-width-source:userset;mso-width-alt:4061;widt=
h:89pt'>
 <col width=3D68 span=3D5 style=3D'width:51pt'>
 <tr height=3D19 style=3D'height:13.9pt'>
  <td height=3D19 class=3Dxl1523823 width=3D74 style=3D'height:13.9pt;width=
:56pt'>引导</td>
  <td class=3Dxl1523823 width=3D95 style=3D'width:71pt'>内核空间</td>
  <td class=3Dxl1523823 width=3D132 style=3D'width:99pt'>用户空间(初始化)</=
td>
  <td class=3Dxl1523823 width=3D115 style=3D'width:86pt'>部分核心服务</td>
  <td class=3Dxl1523823 width=3D150 style=3D'width:112pt'>Art虚拟机初始化</=
td>
  <td class=3Dxl1523823 width=3D104 style=3D'width:78pt'>Java Runtime</td>
  <td class=3Dxl1523823 width=3D140 style=3D'width:105pt'>Java Runtime服务<=
/td>
  <td class=3Dxl1523823 width=3D119 style=3D'width:89pt'>Java Runtime服</td>
  <td class=3Dxl1523823 width=3D68 style=3D'width:51pt'>Java Runti<span
  style=3D'display:none'>me服务</span></td>
  <td class=3Dxl1523823 width=3D68 style=3D'width:51pt'>Java Runti<span
  style=3D'display:none'>me服务</span></td>
  <td class=3Dxl1523823 width=3D68 style=3D'width:51pt'>Java Runti<span
  style=3D'display:none'>me服务</span></td>
  <td class=3Dxl1523823 colspan=3D2 width=3D136 style=3D'width:102pt'>Java =
Runtime服务</td>
 </tr>
 <tr height=3D19 style=3D'height:13.9pt'>
  <td height=3D19 class=3Dxl1523823 style=3D'height:13.9pt'>[PBL]() ↓</td>
  <td class=3Dxl6623823><a
  href=3D"http://huaqianlee.github.io/2015/08/15/Android/%E9%AB%98%E9%80%9A=
%E5%B9%B3%E5%8F%B0Android%E6%BA%90%E7%A0%81bootloader%E5%88%86%E6%9E%90%E4%=
B9%8Bsbl1-%E4%B8%80/"
  target=3D"_parent">b</a></td>
  <td class=3Dxl6523823 align=3Dright width=3D132 style=3D'width:99pt'>1</t=
d>
  <td class=3Dxl1523823>b</td>
  <td class=3Dxl1523823>b</td>
  <td class=3Dxl1523823></td>
  <td class=3Dxl1523823></td>
  <td class=3Dxl1523823></td>
  <td class=3Dxl1523823></td>
  <td class=3Dxl1523823></td>
  <td class=3Dxl1523823></td>
  <td class=3Dxl1523823></td>
  <td class=3Dxl1523823></td>
 </tr>
 <![if supportMisalignedColumns]>
 <tr height=3D0 style=3D'display:none'>
  <td width=3D74 style=3D'width:56pt'></td>
  <td width=3D95 style=3D'width:71pt'></td>
  <td width=3D132 style=3D'width:99pt'></td>
  <td width=3D115 style=3D'width:86pt'></td>
  <td width=3D150 style=3D'width:112pt'></td>
  <td width=3D104 style=3D'width:78pt'></td>
  <td width=3D140 style=3D'width:105pt'></td>
  <td width=3D119 style=3D'width:89pt'></td>
  <td width=3D68 style=3D'width:51pt'></td>
  <td width=3D68 style=3D'width:51pt'></td>
  <td width=3D68 style=3D'width:51pt'></td>
  <td width=3D68 style=3D'width:51pt'></td>
  <td width=3D68 style=3D'width:51pt'></td>
 </tr>
 <![endif]>
</table>