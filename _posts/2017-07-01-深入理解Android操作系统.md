---
title: 深入理解Android操作系统
layout: post
categories: 技术
tags: framework
---
Android Source:7.1.1

Linux Kernel:3.18

## 主线：开机到启动桌面过程
|引导 ▪|内核空间 ▪|用户空间(初始化) ▪|部分核心服务 ▪|Art虚拟机初始化 ▪|Java Runtime ▪|Java Runtime服务 ▪|Java Runtime服务 ▪|
|--:|--:|--:|--:|--:|--:|--:|
|[PBL](http://huaqianlee.github.io/2015/08/15/Android/%E9%AB%98%E9%80%9A%E5%B9%B3%E5%8F%B0Android%E6%BA%90%E7%A0%81bootloader%E5%88%86%E6%9E%90%E4%B9%8Bsbl1-%E4%B8%80/) ↓
|[init.S](http://androidxref.com/4.1.2/xref/bootable/bootloader/legacy/usbloader/init.S) ↓|
|**main.c:**[_main](http://androidxref.com/4.1.2/xref/bootable/bootloader/legacy/usbloader/main.c) →|**(PID=0) main.c:**[start_kernel](http://androidxref.com/kernel_3.18/xref/init/main.c) ↓|
||**main.c:**[rest_init](http://androidxref.com/kernel_3.18/xref/init/main.c) ↓|
||**main.c:**[kernel_init](http://androidxref.com/kernel_3.18/xref/init/main.c) →|**(PID=1)init.c:**[main](http://androidxref.com/7.1.1_r6/xref/system/core/init/init.cpp) ↓|
|||[init.rc](http://androidxref.com/7.1.1_r6/xref/system/core/rootdir/init.rc#39) →|**(PPID=1 假设PID=200)**[zygote](http://androidxref.com/7.1.1_r6/xref/frameworks/base/cmds/app_process/app_main.cpp) →|**AndroidRuntime.cpp:**[start](http://androidxref.com/7.1.1_r6/xref/frameworks/base/core/jni/AndroidRuntime.cpp#974) ↓|
|||→|**(PPID=1)** [servicemanager](http://androidxref.com/7.1.1_r6/xref/frameworks/native/cmds/servicemanager/service_manager.c) |**AndroidRuntime.cpp:**[startVm](http://androidxref.com/7.1.1_r6/xref/frameworks/base/core/jni/AndroidRuntime.cpp#581) ↓|
|||→|**(PPID=1)** [surfaceflinger](http://androidxref.com/7.1.1_r6/xref/frameworks/native/services/surfaceflinger/main_surfaceflinger.cpp)|**java_vm_ext.cc:**[JNI_CreateJavaVM](http://androidxref.com/7.1.1_r6/xref/art/runtime/java_vm_ext.cc#939) ↓|
|||→|**(PPID=1)** [cameraserver](http://androidxref.com/7.1.1_r6/xref/frameworks/av/camera/cameraserver/main_cameraserver.cpp)|**runtime.cc:**[Create](http://androidxref.com/7.1.1_r6/xref/art/runtime/runtime.cc#Create) ↓|
|||→|**(PPID=1)** [mediaserver](http://androidxref.com/7.1.1_r6/xref/frameworks/av/media/mediaserver/main_mediaserver.cpp)|**runtime.cc:**[Init](http://androidxref.com/7.1.1_r6/xref/art/runtime/runtime.cc#Init) ↓|
|||→|**(PPID=1)** [audioserver](http://androidxref.com/7.1.1_r6/xref/frameworks/av/media/audioserver/main_audioserver.cpp)|**runtime.cc:**[Start](http://androidxref.com/7.1.1_r6/xref/art/runtime/runtime.cc#Start) ↓|
|||||**AndroidRuntime.cpp:**[startReg](http://androidxref.com/7.1.1_r6/xref/frameworks/base/core/jni/AndroidRuntime.cpp#581) ↓|
|||||**END** →|**ZygoteInit.java:**[main](http://androidxref.com/7.1.1_r6/xref/frameworks/base/core/java/com/android/internal/os/ZygoteInit.java#709) →|-------------------------------|


PID = 当前进程ID
PPID = 父进程ID

PBL

[select/poll/epoll](https://segmentfault.com/a/1190000003063859)

当电源按下，引导芯片代码开始从预定义的地方（固化在ROM）开始执行。加载引导程序到RAM，然后执行

**ZygoteInit.java:**[main](http://androidxref.com/7.1.1_r6/xref/frameworks/base/core/java/com/android/internal/os/ZygoteInit.java#709) ↓
**fork ZygoteInit.java:**[startSystemServer](http://androidxref.com/7.1.1_r6/xref/frameworks/base/core/java/com/android/internal/os/ZygoteInit.java#709) ↓

**进入轮询等待连接**